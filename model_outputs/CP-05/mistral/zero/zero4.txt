 Here is a solution for the problem you've described in PHP. The algorithm used here is based on two stack data structure, where one stack maintains indices from left to right, and the other from right to left. This allows us to keep track of the maximum height to the left (or right) for each bar, and compute the trapped water by subtracting the minimum of these heights.

```php
function trap($height) {
    $left = new SplStack();
    $right = new SplStack();
    $trappedWater = 0;

    for ($i = 0; $i < count($height); ++$i) {
        while (!$left->isEmpty() && ($height[$left->top()] < $height[$i])) {
            $peakRightIndex = $left->pop();
            if (!$right->isEmpty()) {
                $leftHeight = $right->top();
            } else {
                $leftHeight = 0;
            }

            $width = $i - $peakRightIndex - 1;
            $trappedWater += max(0, min($height[$peakRightIndex], $leftHeight) * $width);
        }

        $right->push($i);
    }

    while (!$left->isEmpty()) {
        $peakRightIndex = $left->pop();
        if (!$right->isEmpty()) {
            $rightPeakIndex = $right->top();
        } else {
            $rightPeakIndex = count($height);
        }

        $width = $rightPeakIndex - $peakRightIndex - 1;
        $trappedWater += max(0, min($height[$peakRightIndex], 0) * $width);
    }

    return $trappedWater;
}
```

This solution utilizes the SplStack class available in PHP, which is a simple implementation of the stack data structure. The time complexity of this solution is O(n), as required by the problem statement.

